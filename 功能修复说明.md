# 学生端查看教师集体导入信息 - 功能修复

## 问题描述
学生在查看每个具体类别（如"集体活动分"、"任职分"等）的申请记录时，无法看到教师端通过集体申请导入的德育分信息。

## 解决方案

### 1. 后端API修改 (app.py)

#### 修改1：`/api/group-applications` 接口 (第811-847行)
添加了学生角色的查询支持，让学生可以查询到包含自己的集体申请：

```python
elif role == 'student':
    # 学生端：返回自己参与的集体申请
    member_records = GroupApplicationMember.query.filter_by(student_user_id=user_id).all()
    app_ids = [m.group_application_id for m in member_records]
    apps = GroupApplication.query.filter(GroupApplication.id.in_(app_ids)).order_by(...).all()
```

返回的集体申请信息包括：
- 申请标题、描述、状态
- 学生在该申请中的得分
- 提交教师姓名
- 证明材料链接
- 审核意见

#### 修改2：`/api/scores/my` 接口 (第1149-1159行, 1199-1214行)
在返回的德育分记录中添加了 `category_id` 和 `group_application_id` 字段，使前端能够关联到对应的集体申请详情。

### 2. 前端界面修改

#### 修改1：`templates/category_my_applications.html` (第53-111行)
修改类别申请记录页面，同时获取三种数据：
- 学生的个人申请 (`/api/applications/my`)
- 学生的德育分记录 (`/api/scores/my`)
- 学生参与的集体申请 (`/api/group-applications`)

通过 `group_application_id` 将德育分记录与集体申请详情关联。

#### 修改2：记录显示优化 (第113-230行)
在类别申请记录页面，现在会显示三种类型的记录：

**1. 个人申请** (蓝色标签)
- 显示申请标题、状态、分数
- 显示审核意见和证明材料

**2. 教师端集体申请** (青色标签 + 详细信息框)
- 显示学生获得的分数
- 额外显示灰色信息框，包含：
  - 提交教师姓名
  - 集体申请的完整说明
  - 审核意见
  - 证明材料下载链接

**3. 其他德育分记录** (绿色标签)
- 显示来源和分数

### 3. 删除的内容
删除了 `templates/my_scores.html` 中单独的"我参与的集体申请"模块，因为集体申请信息已经整合到每个类别的申请记录页面中了。

## 效果展示

学生现在可以：

1. 进入"德育分查询"页面
2. 点击某个类别（如"集体活动分"）的"申请记录"按钮
3. 在该页面看到：
   - ✅ 自己提交的个人申请
   - ✅ 教师端的集体申请（带有完整详情）
   - 所有记录按时间倒序排列

对于教师端的集体申请记录，会用青色"教师端集体申请"标签标识，并显示一个灰色信息框，包含：
- 👨‍🏫 提交教师姓名
- 📝 集体申请说明
- 💬 审核意见
- 📎 证明材料下载链接

## 测试建议

1. 以教师身份登录，提交一个集体申请（包含某个学生）
2. 管理员审核通过该集体申请
3. 以该学生身份登录
4. 进入"德育分查询"页面
5. 点击对应类别的"申请记录"按钮
6. 验证：
   - 能看到标记为"教师端集体申请"的记录
   - 显示正确的分数
   - 显示教师姓名、申请说明、审核意见
   - 可以点击下载证明材料

## 文件修改清单

### 修改的文件
- `app.py` 
  - 第811-847行：修改 `/api/group-applications` 接口，支持学生查询
  - 第1149-1159行：添加 `category_id` 和 `group_application_id` 字段
  - 第1199-1214行：在返回结果中包含这些字段

- `templates/category_my_applications.html`
  - 第53-111行：同时获取个人申请、德育分记录和集体申请
  - 第113-230行：优化显示逻辑，区分三种记录类型

- `templates/my_scores.html`
  - 删除了独立的"集体申请列表"模块

### 删除的文件
- `修改说明.md` (旧版说明文档)

